<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غرف الدردشة والألعاب</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .room-section, .chat-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .room-controls {
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .room-info {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .message-user {
            font-weight: bold;
            color: #667eea;
        }

        .games-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .game-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tic-tac-toe {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 300px;
            margin: 20px auto;
        }

        .tic-cell {
            width: 80px;
            height: 80px;
            border: 2px solid #667eea;
            background: white;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tic-cell:hover {
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .quiz-section {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .question {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .answer-btn {
            padding: 10px;
            border: 2px solid #ff7b7b;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .answer-btn:hover {
            background: #ff7b7b;
            color: white;
            transform: translateY(-2px);
        }

        .scores {
            background: linear-gradient(45deg, #d299c2, #fef9d7);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tic-cell {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 غرف الدردشة والألعاب التفاعلية 🎮</h1>
            <p>أنشئ غرفة مع أصدقائك وتحدثوا والعبوا معًا!</p>
        </div>

        <div class="main-content">
            <div class="room-section">
                <h3>إدارة الغرف</h3>
                
                <div class="room-controls">
                    <div class="input-group">
                        <label>اسمك:</label>
                        <input type="text" id="username" placeholder="أدخل اسمك">
                    </div>
                    
                    <div class="input-group">
                        <label>كود الغرفة (للانضمام):</label>
                        <input type="text" id="roomCode" placeholder="أدخل كود الغرفة">
                    </div>
                    
                    <button class="btn btn-primary" onclick="createRoom()">إنشاء غرفة جديدة</button>
                    <button class="btn btn-secondary" onclick="joinRoom()">الانضمام للغرفة</button>
                </div>

                <div id="roomInfo" class="room-info hidden">
                    <h4>معلومات الغرفة</h4>
                    <p>كود الغرفة: <span id="currentRoomCode"></span></p>
                    <p>عدد المتصلين: <span id="connectedUsers">0</span></p>
                    <button class="btn btn-secondary" onclick="leaveRoom()">مغادرة الغرفة</button>
                </div>
            </div>

            <div class="chat-section">
                <h3>💬 الدردشة</h3>
                <div id="chatMessages" class="chat-messages"></div>
                <div class="input-group">
                    <input type="text" id="messageInput" placeholder="أكتب رسالتك هنا..." onkeypress="handleKeyPress(event)">
                    <button class="btn btn-primary" onclick="sendMessage()">إرسال</button>
                </div>
            </div>
        </div>

        <div class="games-section">
            <h3>🎯 الألعاب</h3>
            
            <div class="game-buttons">
                <button class="btn btn-primary" onclick="showGame('ticTacToe')">لعبة XO</button>
                <button class="btn btn-primary" onclick="showGame('quiz')">أسئلة ذكية</button>
                <button class="btn btn-primary" onclick="showGame('mathQuiz')">أسئلة رياضية</button>
                <button class="btn btn-primary" onclick="showGame('scienceQuiz')">أسئلة علمية</button>
            </div>

            <!-- لعبة XO -->
            <div id="ticTacToeGame" class="hidden">
                <h4>🎮 لعبة XO</h4>
                <p>الدور الحالي: <span id="currentPlayer">X</span></p>
                <div class="tic-tac-toe" id="ticTacToeBoard"></div>
                <button class="btn btn-secondary" onclick="resetTicTacToe()">إعادة تشغيل</button>
            </div>

            <!-- لعبة الأسئلة -->
            <div id="quizGame" class="hidden">
                <div class="quiz-section">
                    <h4>🧠 أسئلة ذكية</h4>
                    <div id="quizTimer" style="font-size: 24px; font-weight: bold; color: #ff4757; text-align: center; margin-bottom: 15px;">5</div>
                    <div class="question" id="questionText"></div>
                    <div class="answers" id="answersContainer"></div>
                    <div id="questionResult" style="margin-top: 15px; padding: 10px; border-radius: 8px; font-weight: bold; text-align: center;"></div>
                    <button class="btn btn-secondary" onclick="nextQuestion()">السؤال التالي</button>
                </div>
            </div>

            <div class="scores">
                <h4>📊 النقاط</h4>
                <div id="scoresContainer">لا توجد نقاط بعد</div>
            </div>
        </div>
    </div>

    <script>
        // متغيرات عامة
        let currentRoom = null;
        let currentUser = null;
        let users = {};
        let scores = {};
        let currentGame = null;
        let ticTacToeBoard = Array(9).fill('');
        let currentTicTacToePlayer = 'X';
        let quizTimer = null;
        let questionAnswered = false;
        let firstAnswerer = null;

        // أسئلة متنوعة
        const questions = {
            general: [
                {
                    question: "ما هو أكبر كوكب في المجموعة الشمسية؟",
                    answers: ["المشتري", "زحل", "الأرض", "المريخ"],
                    correct: 0
                },
                {
                    question: "كم عدد قارات العالم؟",
                    answers: ["5", "6", "7", "8"],
                    correct: 2
                },
                {
                    question: "ما هي عاصمة فرنسا؟",
                    answers: ["مرسيليا", "ليون", "باريس", "نيس"],
                    correct: 2
                },
                {
                    question: "من كتب رواية 'مئة عام من العزلة'؟",
                    answers: ["غارسيا ماركيز", "بورخيس", "فارغاس يوسا", "إيزابيل الليندي"],
                    correct: 0
                }
            ],
            math: [
                {
                    question: "ما هو ناتج 15 × 8؟",
                    answers: ["110", "120", "130", "140"],
                    correct: 1
                },
                {
                    question: "ما هو الجذر التربيعي لـ 144؟",
                    answers: ["11", "12", "13", "14"],
                    correct: 1
                },
                {
                    question: "كم يساوي 2³؟",
                    answers: ["6", "8", "9", "12"],
                    correct: 1
                }
            ],
            science: [
                {
                    question: "ما هو الرمز الكيميائي للذهب؟",
                    answers: ["Go", "Gd", "Au", "Ag"],
                    correct: 2
                },
                {
                    question: "كم عدد عظام الإنسان البالغ؟",
                    answers: ["206", "208", "210", "212"],
                    correct: 0
                },
                {
                    question: "ما هو أسرع حيوان في العالم؟",
                    answers: ["الفهد", "النمر", "الأسد", "الصقر الشاهين"],
                    correct: 3
                }
            ]
        };

        let currentQuestions = questions.general;
        let currentQuestionIndex = 0;

        // وظائف إدارة الغرف
        function createRoom() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                alert('يرجى إدخال اسمك أولاً');
                return;
            }

            const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            currentRoom = roomCode;
            currentUser = username;
            users[username] = { score: 0 };
            scores[username] = 0;

            document.getElementById('currentRoomCode').textContent = roomCode;
            document.getElementById('connectedUsers').textContent = '1';
            document.getElementById('roomInfo').classList.remove('hidden');

            addMessage('النظام', `تم إنشاء الغرفة بنجاح! شارك الكود ${roomCode} مع أصدقائك`);
            updateScores();
        }

        function joinRoom() {
            const username = document.getElementById('username').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim();
            
            if (!username || !roomCode) {
                alert('يرجى إدخال اسمك وكود الغرفة');
                return;
            }

            currentRoom = roomCode;
            currentUser = username;
            users[username] = { score: 0 };
            scores[username] = 0;

            document.getElementById('currentRoomCode').textContent = roomCode;
            document.getElementById('connectedUsers').textContent = Object.keys(users).length;
            document.getElementById('roomInfo').classList.remove('hidden');

            addMessage('النظام', `${username} انضم إلى الغرفة`);
            updateScores();
        }

        function leaveRoom() {
            if (currentUser && users[currentUser]) {
                delete users[currentUser];
                delete scores[currentUser];
            }
            
            currentRoom = null;
            currentUser = null;
            document.getElementById('roomInfo').classList.add('hidden');
            document.getElementById('chatMessages').innerHTML = '';
            updateScores();
        }

        // وظائف الدردشة
        function addMessage(user, message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `<span class="message-user">${user}:</span> ${message}`;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || !currentUser) return;

            addMessage(currentUser, message);
            messageInput.value = '';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // وظائف الألعاب
        function showGame(gameType) {
            // التحقق من وجود لاعبين على الأقل
            const playerCount = Object.keys(users).length;
            if (playerCount < 2) {
                alert('يجب أن يكون هناك لاعبين على الأقل لبدء اللعبة!');
                addMessage('النظام', '⚠️ يجب انتظار لاعب آخر للعب');
                return;
            }

            // إخفاء جميع الألعاب
            document.getElementById('ticTacToeGame').classList.add('hidden');
            document.getElementById('quizGame').classList.add('hidden');

            switch(gameType) {
                case 'ticTacToe':
                    document.getElementById('ticTacToeGame').classList.remove('hidden');
                    initTicTacToe();
                    break;
                case 'quiz':
                    currentQuestions = questions.general;
                    currentQuestionIndex = 0;
                    document.getElementById('quizGame').classList.remove('hidden');
                    startQuizGame();
                    break;
                case 'mathQuiz':
                    currentQuestions = questions.math;
                    currentQuestionIndex = 0;
                    document.getElementById('quizGame').classList.remove('hidden');
                    startQuizGame();
                    break;
                case 'scienceQuiz':
                    currentQuestions = questions.science;
                    currentQuestionIndex = 0;
                    document.getElementById('quizGame').classList.remove('hidden');
                    startQuizGame();
                    break;
            }
        }

        // لعبة XO
        function initTicTacToe() {
            const board = document.getElementById('ticTacToeBoard');
            board.innerHTML = '';
            ticTacToeBoard = Array(9).fill('');
            currentTicTacToePlayer = 'X';
            document.getElementById('currentPlayer').textContent = 'X';

            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('button');
                cell.className = 'tic-cell';
                cell.onclick = () => makeMove(i);
                board.appendChild(cell);
            }
        }

        function makeMove(index) {
            if (ticTacToeBoard[index] || !currentUser) return;

            // التحقق من وجود لاعبين
            const playerCount = Object.keys(users).length;
            if (playerCount < 2) {
                alert('يجب أن يكون هناك لاعبين على الأقل للعب!');
                return;
            }

            ticTacToeBoard[index] = currentTicTacToePlayer;
            document.getElementById('ticTacToeBoard').children[index].textContent = currentTicTacToePlayer;

            if (checkWinner()) {
                addMessage('النظام', `🎉 ${currentUser} فاز في لعبة XO!`);
                scores[currentUser] = (scores[currentUser] || 0) + 10;
                updateScores();
                return;
            }

            if (ticTacToeBoard.every(cell => cell !== '')) {
                addMessage('النظام', 'تعادل في لعبة XO!');
                return;
            }

            currentTicTacToePlayer = currentTicTacToePlayer === 'X' ? 'O' : 'X';
            document.getElementById('currentPlayer').textContent = currentTicTacToePlayer;
        }

        function checkWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];

            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return ticTacToeBoard[a] && 
                       ticTacToeBoard[a] === ticTacToeBoard[b] && 
                       ticTacToeBoard[a] === ticTacToeBoard[c];
            });
        }

        function resetTicTacToe() {
            initTicTacToe();
        }

        // لعبة الأسئلة
        function startQuizGame() {
            addMessage('النظام', '🎯 بدء لعبة الأسئلة! لديكم 5 ثوانٍ للإجابة على كل سؤال');
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                addMessage('النظام', 'انتهت جميع الأسئلة!');
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionResult').innerHTML = '';
            document.getElementById('questionResult').style.display = 'none';
            
            // إعادة تعيين حالة السؤال
            questionAnswered = false;
            firstAnswerer = null;
            
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';

            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => checkAnswer(index, currentUser);
                button.disabled = false;
                answersContainer.appendChild(button);
            });

            // بدء العد التنازلي
            startQuizTimer();
        }

        function startQuizTimer() {
            let timeLeft = 5;
            const timerElement = document.getElementById('quizTimer');
            timerElement.textContent = timeLeft;
            timerElement.style.color = '#ff4757';

            quizTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    if (!questionAnswered) {
                        addMessage('النظام', '⏰ انتهى الوقت! لم يجب أحد في الوقت المحدد');
                        disableAnswerButtons();
                        showQuestionResult('انتهى الوقت!', '#ff4757');
                    }
                }
            }, 1000);
        }

        function checkAnswer(selectedIndex, answeringUser) {
            if (questionAnswered) return;

            const question = currentQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;
            
            // إيقاف المؤقت
            clearInterval(quizTimer);
            
            if (isCorrect) {
                // الإجابة صحيحة - يحصل على النقطة
                questionAnswered = true;
                scores[answeringUser] = (scores[answeringUser] || 0) + 1;
                addMessage('النظام', `✅ ${answeringUser} أجاب بشكل صحيح أولاً! +1 نقطة`);
                showQuestionResult(`${answeringUser} أجاب بشكل صحيح!`, '#2ed573');
                disableAnswerButtons();
                updateScores();
            } else {
                // الإجابة خاطئة
                if (!firstAnswerer) {
                    firstAnswerer = answeringUser;
                    addMessage('النظام', `❌ ${answeringUser} أجاب خطأ! فرصة للآخرين`);
                    showQuestionResult(`${answeringUser} أجاب خطأ - فرصة للآخرين`, '#ff6b6b');
                    
                    // إزالة الزر الذي اختاره اللاعب الأول
                    const buttons = document.querySelectorAll('.answer-btn');
                    buttons[selectedIndex].disabled = true;
                    buttons[selectedIndex].style.opacity = '0.5';
                    
                    // إعادة تشغيل المؤقت للاعبين الآخرين
                    startQuizTimer();
                } else {
                    // اللاعب الثاني أجاب خطأ أيضاً
                    questionAnswered = true;
                    addMessage('النظام', `❌ ${answeringUser} أجاب خطأ أيضاً! الإجابة الصحيحة: ${question.answers[question.correct]}`);
                    showQuestionResult(`كلاكما أجاب خطأ! الإجابة الصحيحة: ${question.answers[question.correct]}`, '#ff4757');
                    disableAnswerButtons();
                }
            }
        }

        function disableAnswerButtons() {
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(button => {
                button.disabled = true;
                button.style.opacity = '0.7';
            });
        }

        function showQuestionResult(message, color) {
            const resultDiv = document.getElementById('questionResult');
            resultDiv.innerHTML = message;
            resultDiv.style.backgroundColor = color;
            resultDiv.style.color = 'white';
            resultDiv.style.display = 'block';
        }

        function nextQuestion() {
            // إيقاف المؤقت إذا كان يعمل
            if (quizTimer) {
                clearInterval(quizTimer);
            }
            
            currentQuestionIndex++;
            showQuestion();
        }

        // تحديث النقاط
        function updateScores() {
            const scoresContainer = document.getElementById('scoresContainer');
            if (Object.keys(scores).length === 0) {
                scoresContainer.innerHTML = 'لا توجد نقاط بعد';
                return;
            }

            const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            scoresContainer.innerHTML = sortedScores.map(([user, score], index) => 
                `<p>${index + 1}. ${user}: ${score} نقطة</p>`
            ).join('');
        }

        // تهيئة اللعبة
        document.addEventListener('DOMContentLoaded', function() {
            addMessage('النظام', 'مرحباً بك! أنشئ غرفة جديدة أو انضم لغرفة موجودة لتبدأ اللعب');
        });
    </script>
</body>
</html>